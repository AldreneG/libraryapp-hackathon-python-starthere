# Generated by Django 2.1.4 on 2019-01-14 10:37

from django.db import migrations

from django.contrib.auth.models import Group, Permission
from django.contrib.contenttypes.models import ContentType
from django.contrib.auth.management import create_permissions


def add_user_groups(apps, schema_editor):
    # We can't import the Group model directly as it may be a newer
    # version than this migration expects. We use the historical version.
    # Group = apps.get_model('auth', 'Group')
    # Permission = apps.get_model('auth', 'Permission')

    # Ensure all the permissions are created
    for app_config in apps.get_app_configs():
        app_config.models_module = True
        create_permissions(app_config, apps=apps, verbosity=0)
        app_config.models_module = None


    librarian, _created = Group.objects.get_or_create(name='Librarian')
    for perm_name in ["add_user", "change_user", "delete_user", "view_user", 
            "add_book", "change_book", "delete_book", "view_book", "add_copy", 
            "change_copy", "delete_copy", "view_copy", "add_loan", 
            "can_mark_loaned", "can_mark_returned", "can_view_all_loans", 
            "change_loan", "delete_loan", "view_loan"]:
        perm = Permission.objects.get(codename=perm_name)
        librarian.permissions.add(perm)

    library_user, _created = Group.objects.get_or_create(name='Library user')
    for perm_name in ["view_book", "view_copy", "view_loan"]:
        perm = Permission.objects.get(codename=perm_name)
        library_user.permissions.add(perm)

class Migration(migrations.Migration):

    dependencies = [
        ('library', '0001_initial'),
        ('auth', '0009_alter_user_last_name_max_length'),
        ('contenttypes', '0002_remove_content_type_name'),
        ('sessions', '0001_initial'),
        ('admin', '0003_logentry_add_action_flag_choices'),
    ]

    operations = [
        migrations.RunPython(add_user_groups),
    ]
