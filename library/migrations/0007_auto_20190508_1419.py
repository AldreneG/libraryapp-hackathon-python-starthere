# Generated by Django 2.1.7 on 2019-05-08 13:19

from django.db import migrations

from django.contrib.auth.models import Group, Permission
from django.contrib.contenttypes.models import ContentType
from django.contrib.auth.management import create_permissions

def add_library_assistant_group(apps, schema_editor):
    # We can't import the Group model directly as it may be a newer
    # version than this migration expects. We use the historical version.
    # Group = apps.get_model('auth', 'Group')
    # Permission = apps.get_model('auth', 'Permission')

    # Ensure all the permissions are created
    for app_config in apps.get_app_configs():
        app_config.models_module = True
        create_permissions(app_config, apps=apps, verbosity=0)
        app_config.models_module = None


    library_assistant, _created = Group.objects.get_or_create(name='Library assistant')
    for perm_name in ["view_user", "view_book", "view_copy", "add_loan", 
            "can_mark_loaned", "can_mark_returned", "can_view_all_loans", 
            "change_loan", "delete_loan", "view_loan"]:
        perm = Permission.objects.get(codename=perm_name)
        library_assistant.permissions.add(perm)


class Migration(migrations.Migration):

    dependencies = [
        ('library', '0006_auto_20190426_1311'),
    ]

    operations = [
        migrations.RunPython(add_library_assistant_group),
    ]
